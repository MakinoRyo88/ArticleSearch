# 🔍 SEO記事統合支援システム

AIを活用した記事類似度分析とSEO最適化のための統合提案システム

## 🎯 システム概要

このシステムは、大量のSEO記事から類似コンテンツを自動検出し、具体的な統合アクション（コンテンツ統合、301リダイレクト、相互リンク等）を提案することで、SEOパフォーマンスの向上を支援します。

### 主な機能

- **チャンクベース類似度分析**: 記事をセクション単位に分割し、精密な内容比較を実行
- **多次元判定アルゴリズム**: 類似度・マッチング率・PV数・講座情報を総合評価
- **5段階の統合提案**: MERGE_CONTENT → REDIRECT_301 → CROSS_LINK → REVIEW → MONITOR
- **視覚的な分析UI**: フィルタリング、ソート、詳細比較機能を搭載

## 🏗️ システム構成

```
┌─────────────────────────────────────────────────────────┐
│                  フロントエンド (Next.js)                 │
│  ┌─────────────────┐  ┌─────────────────┐  ┌──────────┐  │
│  │   記事一覧      │  │   類似度分析    │  │ 詳細比較  │  │
│  │     /articles   │  │ /analyze/:id    │  │/compare  │  │
│  └─────────────────┘  └─────────────────┘  └──────────┘  │
└─────────────────────────────────────────────────────────┘
                           │ HTTP API
┌─────────────────────────────────────────────────────────┐
│                API サーバー (Express.js)                 │
│  ┌─────────────────┐  ┌─────────────────┐  ┌──────────┐  │
│  │ 記事検索API      │  │チャンク類似検索  │  │ 統計API  │  │
│  │                 │  │     API         │  │          │  │
│  └─────────────────┘  └─────────────────┘  └──────────┘  │
└─────────────────────────────────────────────────────────┘
                           │ BigQuery ML
┌─────────────────────────────────────────────────────────┐
│                  データ基盤 (BigQuery)                   │
│  ┌─────────────────┐  ┌─────────────────┐  ┌──────────┐  │
│  │     記事        │  │   チャンク       │  │ 埋め込み  │  │
│  │   テーブル      │  │   テーブル       │  │ベクトル  │  │
│  └─────────────────┘  └─────────────────┘  └──────────┘  │
└─────────────────────────────────────────────────────────┘
```

## 🧠 AIアルゴリズムの特徴

### 1. チャンクベース分析
- 記事を論理的なセクション（チャンク）に分割
- セクションごとにVertex AI Text Embeddingで意味的ベクトル化
- 1対1のコサイン類似度計算で精密な類似性判定

### 2. 重要度加重システム
- **タイトル・見出し**: 5.0倍の重要度
- **導入部**: 3.0倍の重要度
- **結論・まとめ**: 2.0倍の重要度
- **通常の本文**: 1.0倍の重要度
- **参考情報**: 0.5倍の重要度

### 3. 最終スコア計算式
```
最終スコア = 基本スコア(60%) + 加重マッチング率(25%) +
            セマンティックボーナス(最大10%) + メタデータボーナス(最大5%)
```

### 4. 統合提案判定ロジック（統一版v2.1）

| 推奨タイプ | 条件 | 優先度 | 講座制限 |
|-----------|------|--------|----------|
| **MERGE_CONTENT** | 類似度95%+ AND 一致率50%+ | 100 | ❌ なし（講座問わず） |
|  | 類似度92%+ AND 一致率30%+ AND 同講座 | 90 | ✅ 同講座のみ |
| **REDIRECT_301** | 類似度90%+ | 85 | ❌ なし（講座問わず） |
|  | 類似度88%+ AND 一致率20%+ AND 同講座 | 80 | ✅ 同講座のみ |
|  | 類似度85%+ AND 同講座 | 70 | ✅ 同講座のみ |
| **CROSS_LINK** | 類似度75%+ OR (70%+ AND 一致率15%+) | 60 | ❌ なし（講座問わず） |
| **REVIEW** | 類似度65%+ AND 同講座 AND 一致率10%以下 | 50 | ✅ 同講座のみ |
|  | 類似度65%+ AND 異講座 AND 一致率15%以下 | 45 | ⚠️ 異講座対応 |
| **MONITOR** | 類似度60%+ | 40 | ❌ なし（講座問わず） |

**重要な改善点:**
- 🔥 **極めて高い類似度（95%+、90%+）は講座問わず重複対策を推奨**
- ⚡ **SEO重複リスクを講座の違いよりも優先**
- 🔗 **相互リンクと監視は元々講座制限なし**
- 👁️ **レビュー推奨に異なる講座用の条件を追加**

## 🚀 技術スタック

### フロントエンド
- **Next.js 14** (React フレームワーク)
- **TypeScript** (型安全性)
- **Tailwind CSS** (スタイリング)
- **Shadcn/ui** (UIコンポーネント)

### バックエンド
- **Node.js + Express** (API サーバー)
- **BigQuery ML** (機械学習とデータ分析)
- **Google Cloud Run** (コンテナ デプロイ)
- **Vertex AI** (テキスト埋め込み)
- **ローカルLLM** (GPU インスタンス)

### データベース・インフラ
- **BigQuery** (データウェアハウス)
  - `content_analysis.articles` (記事メタデータ)
  - `content_analysis.article_chunks` (チャンクとベクトル)
  - `monitoring.usage_logs` (使用状況ログ)
  - `monitoring.performance_metrics` (パフォーマンス指標)
- **Cloud Functions** (マイクロサービス)
  - LLMインスタンス管理 (起動・停止)
  - データ同期・埋め込み生成
  - 監視・メトリクス収集
- **Compute Engine** (GPU インスタンス)
  - ローカルLLM実行環境
  - スナップショット自動復元機能

## 📊 パフォーマンス指標

- **記事数**: 779記事
- **総チャンク数**: 7,720セクション
- **平均チャンク数/記事**: 10セクション
- **埋め込みカバレッジ**: 100%
- **平均レスポンス時間**: 2-5秒（記事サイズにより変動）

## 🔧 API エンドポイント

### チャンクベース類似検索（メイン機能）
```bash
GET /api/chunk-similarity/{articleId}

# パラメータ
?limit=20           # 返却数 (1-50)
?threshold=0.5      # 類似度閾値 (0.0-1.0)
?min_pageviews=0    # 最小PV数フィルタ
?top_chunks=10      # 上位チャンク数 (1-20)
```

### 記事検索・一覧
```bash
GET /api/search/articles

# パラメータ
?search=keyword     # タイトル検索
?koza_id=123       # 講座IDフィルタ
?min_pageviews=100 # 最小PV数
?sort=pageviews    # ソート順
```

### LLM統合提案生成
```bash
POST /api/explanations/generate

# ボディパラメータ
{
  "article1_id": "123",
  "article2_id": "456",
  "provider": "vertex-ai|local-llm"  # プロバイダー選択
}
```

### 監視・メトリクス
```bash
GET /api/monitoring/health          # システムヘルスチェック
GET /api/monitoring/usage-statistics # 使用統計
GET /api/monitoring/provider-comparison # プロバイダー比較
```

## 🎮 使い方

### 1. 記事分析の開始
1. `/articles` ページで対象記事を選択
2. 「分析」ボタンをクリック
3. `/articles/{id}/analyze` ページで結果を確認

### 2. フィルタリング機能
- **タイトル検索**: キーワードで絞り込み
- **類似度スライダー**: 50%-100%で範囲指定
- **PV数スライダー**: アクセス数で絞り込み
- **推奨タイプ**: アクションタイプで分類

### 3. 詳細比較
- 「詳細比較」ボタンで2記事の並列比較
- チャンクレベルでの一致箇所を可視化
- 具体的な統合手順を提案

## 📈 ビジネス価値

### SEO改善効果
- **重複コンテンツの解消**: Googleペナルティ回避
- **権威性の集約**: 分散したSEO評価を統合
- **ユーザー体験向上**: 類似記事の整理で迷いを軽減

### 運用効率化
- **手動チェック時間**: 90%削減（推定）
- **判断の標準化**: データドリブンな意思決定
- **優先順位明確化**: 高インパクト作業の特定

## 🔒 セキュリティ

- **認証**: Google Cloud IAM
- **API制限**: レート制限とバリデーション
- **データ暗号化**: 転送時・保存時の両方で実装
- **アクセスログ**: 全API呼び出しを記録

## 🚀 デプロイ・インフラ情報

### メインサービス
- **本番API**: `https://seo-realtime-analysis-api-550580509369.asia-northeast1.run.app`
- **フロントエンド**: Cloud Run (Next.js)
- **更新频度**: リアルタイム（データは日次バッチ更新）

### Cloud Functions (16個の関数)
| 関数名 | 用途 | 状態 |
|--------|------|------|
| `start-llm-instance` | ローカルLLMインスタンス起動 | ✅ ACTIVE |
| `stop-llm-instance` | ローカルLLMインスタンス停止 | ✅ ACTIVE |
| `get-llm-status` | LLM状態監視 | ✅ ACTIVE |
| `articles-ui-api` | 記事UI API | ✅ ACTIVE |
| `generate-embeddings` | 埋め込みベクトル生成 | ✅ ACTIVE |
| `generate-similarity-cache` | 類似度キャッシュ生成 | ✅ ACTIVE |
| `integration-manager` | 統合提案管理 | ✅ ACTIVE |
| `strapi-sync` | CMS データ同期 | ✅ ACTIVE |
| `ga4-sync` | Google Analytics同期 | ✅ ACTIVE |
| その他 | バックアップ・テスト用 | ✅ ACTIVE |

### GPU インスタンス
- **マシンタイプ**: n1-standard-4 + NVIDIA Tesla T4
- **起動方式**: スナップショット自動復元
- **最新スナップショット**: `llm-disk-20251203-153422`
- **コスト削減**: 85% (使用時のみ課金)

## 📚 ドキュメント構成ガイド

このプロジェクトには複数のMDファイルがあります。用途に応じて適切なドキュメントをご参照ください。

### 📋 メインドキュメント
| ファイル | 内容 | 対象者 |
|---------|------|--------|
| **README.md** | プロジェクト全体の概要・基本情報 | 全員 |
| **README-LLM.md** | ローカルLLM統合プロジェクトの詳細 | 開発者・運用者 |

### 🛠️ 技術ドキュメント
| ファイル | 内容 | 対象者 |
|---------|------|--------|
| **API_REFERENCE.md** | API仕様・エンドポイント詳細 | フロントエンド開発者 |
| **ALGORITHM_SPECIFICATION.md** | 類似度アルゴリズムの技術仕様 | アルゴリズム担当者 |
| **PHASE2_DESIGN.md** | Phase 2 LLM統合設計書 | 開発者 |
| **PHASE3_MONITORING_DESIGN.md** | Phase 3 監視システム設計書 | 開発者・運用者 |

### 🎯 運用ドキュメント
| ファイル | 内容 | 対象者 |
|---------|------|--------|
| **AI_DEVELOPMENT_STATUS.md** | 開発進捗・ステータス管理 | 開発者・PM |
| **OPERATION_GUIDE.md** | システム運用手順・トラブル対応 | 運用担当者 |
| **COST_OPTIMIZATION_COMPLETED.md** | コスト最適化完了報告 | マネージャー・運用者 |

### 👥 ビジネスドキュメント
| ファイル | 内容 | 対象者 |
|---------|------|--------|
| **CUSTOMER_EXPLANATION.md** | 顧客向けシステム説明資料 | 営業・顧客 |

### 🔧 Phase 2-3: ローカルLLM統合 + 監視システム

**Phase 2完了**: ローカルLLM導入・プロバイダー選択機能・自動化システム
**Phase 3.1完了**: 基本監視システム・メトリクス収集・BigQuery統合
**Phase 3.2進行中**: 監視ダッシュボード・リアルタイム分析

✅ **達成済み**:
- コスト85%削減達成
- LLMプロバイダー選択UI実装
- 自動起動・停止・フォールバック機能
- 基本監視システム・BigQuery統合
- 使用状況ログ・パフォーマンスメトリクス収集

詳細は **[README-LLM.md](README-LLM.md)** および **[AI_DEVELOPMENT_STATUS.md](AI_DEVELOPMENT_STATUS.md)** を参照。

